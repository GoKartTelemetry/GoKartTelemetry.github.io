<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>GoKartTelemetry</title>

  <!-- Smart App Banner для Safari на iOS -->
  <meta name="apple-itunes-app" content="app-id=6756797114, app-argument=https://gokarttelemetry.github.io">

  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; text-align: center; padding: 60px 20px; color: #1d1d1f; background: #f5f5f7; }
    .app-icon { width: 120px; height: 120px; border-radius: 24px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); margin-bottom: 24px; }
    h1 { font-size: 24px; margin-bottom: 8px; }
    #status-text { color: #86868b; font-size: 16px; margin-bottom: 20px; }
    .loader { border: 3px solid #d2d2d7; border-top: 3px solid #007aff; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; margin: 0 auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    /* Кастомный баннер снизу */
    #gkt-app-banner { position:fixed; left:16px; right:16px; bottom:20px; background:rgba(255,255,255,0.9); backdrop-filter: blur(10px); border: 0.5px solid #d2d2d7; border-radius:14px; box-shadow:0 8px 24px rgba(0,0,0,0.1); display:none; align-items:center; padding:12px; gap:12px; z-index:99999; text-align: left; }
    #gkt-app-banner img { width:44px; height:44px; border-radius:10px; }
    .gkt-info { flex:1; }
    .gkt-title { font-weight:600; font-size:14px; }
    .gkt-sub { color:#6e6e73; font-size:11px; }
    .gkt-actions a { background:#007aff; color:#fff; padding:6px 14px; border-radius:16px; text-decoration:none; font-weight:600; font-size:13px; }
  </style>
</head>
<body>

  <!-- Основное лого на странице (подгружается из App Store) -->
  <img src="https://is1-ssl.mzstatic.com" alt="GoKartTelemetry Logo" class="app-icon">
  
  <h1>Go-Kart Telemetry</h1>
  <div id="status-text">Ищем установленное приложение...</div>
  <div class="loader" id="loader"></div>

  <!-- Всплывающий баннер -->
  <div id="gkt-app-banner" role="dialog">
    <img src="https://is1-ssl.mzstatic.com" alt="GKT">
    <div class="gkt-info">
      <div class="gkt-title">Go-Kart Telemetry</div>
      <div class="gkt-sub">Телеметрия гонок на iOS</div>
    </div>
    <div class="gkt-actions">
      <a href="https://apps.apple.com">Установить</a>
    </div>
  </div>

  <script>
    (function() {
      var appStoreURL = 'https://apps.apple.com';
      var universalLink = 'https://gokarttelemetry.github.io';
      var isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent) && !window.MSStream;

      function openAppOrStore() {
        var start = Date.now();
        
        // Попытка открыть приложение через Universal Link
        window.location.href = universalLink;

        // Если через 2 секунды фокус все еще на странице — идем в App Store
        setTimeout(function() {
          if (document.hasFocus() && (Date.now() - start < 2500)) {
            document.getElementById('status-text').innerText = "Приложение не найдено. Переходим в App Store...";
            window.location.href = appStoreURL;
          }
        }, 2000);
      }

      if (isIOS) {
        setTimeout(openAppOrStore, 800);
      } else {
        document.getElementById('status-text').innerText = "Доступно в App Store для iPhone";
        document.getElementById('loader').style.display = 'none';
        document.getElementById('gkt-app-banner').style.display = 'flex';
      }
    })();
  </script>
</body>
</html>
